<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>Registro | Servicio de Prevención de Violencia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Plantilla Premium Multipropósito para Administradores y Paneles" name="description">
    <meta content="Themesbrand" name="author">
    <!-- Favicon de la aplicación -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Estilos personalizados -->
    <style>
        .btn-rosado {
            background-color: #f5aeac;
            border-color: #f8a09d;
            color: white;
        }

        .btn-rosado:hover {
            background-color: #f8a09d ;
            border-color: #f8a09d ;
            color: white;
        }

        .color-rosado {
            color: #f8a09d  !important;
        }

        .color-negro{
            color: black !important;
        }

        .color-blanco {
            color:white !important;
        }

        .fondo-blanco {
            background-color: white; 
            text-align: center; 
        }
    </style>

</head>

<body>
    <div class="home-btn d-none d-sm-block">
        <a href="index.html" class="text-dark"><i class="fas fa-home h2"></i></a>
    </div>
    <div class="account-pages mb-5 pt-sm-5" style="margin-top: 2.5rem;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="card overflow-hidden">
                        <div class="fondo-blanco pt-4">
                            <div class="row">
                                <div class="col-12">
                                    <div class="text-primary py-0 px-4 pt-2">
                                        <h3 class="text-primary color-negro">Registro</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">

                            <div class="p-2">
                                <form class="form-horizontal" id="registerForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="nombres">Nombres</label>
                                                <input type="text" class="form-control" id="nombres" placeholder="Ingresa tus nombres">
                                                <div id="nombresError" class="error-message"></div>
                                            </div>
                            
                                            <div class="form-group">
                                                <label for="apellidos">Apellidos</label>
                                                <input type="text" class="form-control" id="apellidos" placeholder="Ingresa tus apellidos">
                                                <div id="apellidosError" class="error-message"></div>
                                            </div>
                            
                                            <div class="form-group">
                                                <label for="correo">Correo</label>
                                                <input type="email" class="form-control" id="correo" placeholder="Ingresa tu correo">
                                                <div id="correoError" class="error-message"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="celular">Celular</label>
                                                <input type="tel" class="form-control" id="celular" placeholder="Ingresa tu celular">
                                                <div id="celularError" class="error-message"></div>
                                            </div>
                            
                                            <div class="form-group">
                                                <label for="password">Contraseña</label>
                                                <input type="password" class="form-control" id="password" placeholder="Ingrese su contraseña">
                                                <div id="passwordError" class="error-message"></div>
                                            </div>
                            
                                            <div class="form-group">
                                                <label for="confirmar-password">Confirmar contraseña</label>
                                                <input type="password" class="form-control" id="confirmar-password" placeholder="Confirma tu contraseña">
                                                <div id="confirmarPasswordError" class="error-message"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-rosado btn-block waves-effect waves-light" type="submit">Registrarme</button>
                                    </div>
                                </form>
                            </div>
                            
                        </div>
                        
                    </div>
                    <div class="mt-3 text-center">

                        <div>
                            <div id="response"></div>
                            <p>¿Ya tienes una cuenta? <a href="login.html"
                                class="font-weight-medium color-rosado">Ingresa</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        $(document).ready(function() {
            // Asegurarse de que solo se ingresen números en el campo de celular
            $('#celular').on('input', function() {
                this.value = this.value.replace(/[^\d]/g, ''); // Reemplazar cualquier cosa que no sea un dígito por ''
            });
    
            // Manejador de evento submit para el formulario
            $('#registerForm').on('submit', function(event) {
                event.preventDefault(); // Prevenir la acción de envío por defecto
    
                // Reiniciar mensajes de error
                $('.error-message').text('');
                $('.error-message').css('color', 'black');
    
                // Obtener valores de los campos
                var nombres = $('#nombres').val().trim();
                var apellidos = $('#apellidos').val().trim();
                var correo = $('#correo').val().trim();
                var celular = $('#celular').val().trim();
                var password = $('#password').val().trim();
                var confirmarPassword = $('#confirmar-password').val().trim();
    
                // Validación de campos
                var isValid = true;
    
                if (nombres === '') {
                    $('#nombresError').text('Debe ingresar sus nombres');
                    $('#nombresError').css('color', 'red');
                    isValid = false;
                }
    
                if (apellidos === '') {
                    $('#apellidosError').text('Debe ingresar sus apellidos');
                    $('#apellidosError').css('color', 'red');
                    isValid = false;
                }
    
                if (correo === '') {
                    $('#correoError').text('Debe ingresar su correo');
                    $('#correoError').css('color', 'red');
                    isValid = false;
                } else if (!isValidEmail(correo)) {
                    $('#correoError').text('El correo ingresado no es válido');
                    $('#correoError').css('color', 'red');
                    isValid = false;
                }
    
                if (celular === '') {
                    $('#celularError').text('Debe ingresar su número de celular');
                    $('#celularError').css('color', 'red');
                    isValid = false;
                } else if (!isValidPhoneNumber(celular)) {
                    $('#celularError').text('El número de celular debe contener solo números');
                    $('#celularError').css('color', 'red');
                    isValid = false;
                }
    
                if (password === '') {
                    $('#passwordError').text('Debe ingresar su contraseña');
                    $('#passwordError').css('color', 'red');
                    isValid = false;
                }
    
                if (confirmarPassword === '') {
                    $('#confirmarPasswordError').text('Debe confirmar su contraseña');
                    $('#confirmarPasswordError').css('color', 'red');
                    isValid = false;
                } else if (confirmarPassword !== password) {
                    $('#confirmarPasswordError').text('Las contraseñas no coinciden');
                    $('#confirmarPasswordError').css('color', 'red');
                    isValid = false;
                }
    
                // Si la validación no pasa, salir
                if (!isValid) {
                    return;
                }
    
                // Si todas las validaciones pasan, enviar la solicitud AJAX
                const formData = {
                    email: correo,
                    password: password,
                    confirmPassword: confirmarPassword,
                    firstName: nombres,
                    lastName: apellidos,
                    phone: celular,
                };
    
                $.ajax({
                    url: 'https://premu-api-yygc.onrender.com/api/auth/register',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(response) {
                        window.location.href = 'login.html';
                    },
                    error: function(xhr, status, error) {
                        console.error('Error al registrase:', error);
                        alert('Error en el registro: ' + xhr.responseText);    
                    }
                });
            });
    
            // Función de validación de correo electrónico básica
            function isValidEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }
    
            // Función de validación de número de teléfono (solo números)
            function isValidPhoneNumber(phone) {
                return /^\d+$/.test(phone);
            }
        });
    </script>


    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- App js -->
    <script src="assets/js/app.js"></script>
</body>

</html>
